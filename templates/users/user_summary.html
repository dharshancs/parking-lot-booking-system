

{% extends 'users/user_base.html' %}

{% block title %}User Summary{% endblock %}

{% block content %}
<div class="container">

    <!-- User Greeting -->
    <div class="mb-4 text-center">
        <h2>Welcome, {{ user['name'] }} ðŸ‘‹</h2>
        <p class="text-muted">Hereâ€™s a summary of your parking activity</p>
    </div>

    <!-- Summary Cards -->
    <div class="row g-4 text-center">

        <div class="col-md-4">
            <div class="card shadow-sm border-start border-4 border-primary">
                <div class="card-body">
                    <h5 class="card-title text-primary">Total Bookings</h5>
                    <p class="display-6">{{ total_bookings }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm border-start border-4 border-warning">
                <div class="card-body">
                    <h5 class="card-title text-warning">Active Bookings</h5>
                    <p class="display-6">{{ active_bookings }}</p>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-sm border-start border-4 border-success">
                <div class="card-body">
                    <h5 class="card-title text-success">Total Spent</h5>
                    <p class="display-6">â‚¹{{ total_spent }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Bookings Table -->
    <div class="mt-5">
        <h4 class="mb-3">Recent Bookings</h4>
        {% if recent_bookings %}
        <div class="table-responsive">
            <table class="table table-hover table-bordered text-center">
                <thead class="table-primary" style="align-items: center;" >
                    <tr >
                        <th >Booking ID</th>
                        <th>Spot</th>
                        <th>Lot ID</th>
                        <th>Booked At</th>
                        <th>Released At</th>
                        <th>Status</th>
                        <th>Price</th>
                    </tr>
                </thead>

                <tbody>
                    {% for booking in recent_bookings %}
                    <tr class="text-center">
                        <td>{{ booking['id'] }}</td>
                        <td>{{ booking['spot_number'] }}</td>
                        <td>{{ booking['lot_id'] }}</td>
                        <td>{{ datetime.fromtimestamp(booking['timestamp_booked']).strftime('%d-%m-%Y %H:%M:%S') or 'â€”' }}</td>
                        <td>{% if booking['timestamp_released'] %}{{ datetime.fromtimestamp(booking['timestamp_released']).strftime('%d-%m-%Y %H:%M:%S')}}{%else%}      NA{%endif%}</td>
                        <td>
                            {% if booking['booking_status'] == 'open' %}
                                <span class="badge bg-warning text-dark">Active</span>
                            {% elif booking['booking_status'] == 'closed' %}
                                <span class="badge bg-success">Completed</span>
                            {% else %}
                                <span class="badge bg-secondary">Other</span>
                            {% endif %}
                        </td>
                        <td>{{ booking['price'] or 0 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted">No recent bookings found.</p>
        {% endif %}
    </div>

</div>
{% endblock %}

