{% extends 'users/user_base.html' %}
{% block title %} Parking App -User {% endblock %}

{%block content%}
    <link rel="stylesheet" href="/static/view.css">



</div>
{% if booking_details %}
<div class="header">Recent Parking History</div>



<div class="table-container">
    <table class="styled-table">
        <thead>
            <tr>
                <th>Booking ID</th>
                <th>Location</th>
                <th>Vehicle Number</th>
                <th>Timestamp</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>

            {%for details in booking_details%}
            <tr>
                <td>{{details['id']}}</td>
                <td>{{details['pl']}}</td>
                <td>{{details['vn']}}</td>
                <td>{{datetime.fromtimestamp(details['tb']).strftime('%d-%m-%Y %H:%M:%S')}}</td>
                <td><label for="release-modal-toggle-{{details['id']}}" class="btn btn-primary-{%if details['b_status']=='closed'%}parked{%else%}release{%endif%}">{%if details['b_status']=="closed"%}Parked Out{%else%}Release{%endif%}</label>
                        <link rel="stylesheet" href="/static/popup.css">
    <input type="checkbox" id="release-modal-toggle-{{details['id']}}" class="modal-toggle" hidden>

    <div class="modal" id="release-modal-{{details['id']}}">
        <div class="modal-content">
            <label for="release-modal-toggle-{{details['id']}}" class="close-btn">X</label>
            <h5>Release the booked spot</h5>
            <form method="POST">
                <input type="hidden" name="form_type" value="release_spot">
                <input type="text" name="lot_id" value="{{details['li']}}" readonly  hidden >
                <input type="text" name="spot_number" value="{{details['sn']}}" readonly  ><br>
                <input type="text" name="vehicle_number" value="{{details['vn']}}" readonly ><br>
                <input type="text" name="parking_time"  value="{{datetime.fromtimestamp(details['tb']).strftime('%d-%m-%Y %H:%M:%S')}}" readonly><br>
                <input type="text" name="release_time" value="{{ datetime.now().strftime('%d-%m-%Y %H:%M:%S') }}" readonly ><br>
                <input type="text" name="total_cost" value="&#8377;{{ (((datetime.now().timestamp() - details['tb']) /3600 ) * details['price'])  | round(2) }}" readonly  ><br>

                <button type="submit">Release</button>
                        <label for="release-modal-toggle-{{details['id']}}" class="btn btn-secondary cancel-btn">Cancel</label>
            </form>
        </div>
    </div></td>



            
                
            </tr>
            {%endfor%}

{% else %}
<div class="header">No Parking History Found</div>
{% endif %}
        </tbody>
    </table>
</div>


<br>
<div class="line-break"></div>
<br>
<form method="POST">
<input type="hidden" name="form_type" value="search_parking">
<div style="display: flex; align-items: center; justify-content: center; gap: 0px; margin: 20px 0;">
  <div style="color: red; font-family: 'Comic Sans MS', 'Patrick Hand', cursive; font-size: 24px; font-weight: bold;margin-right: 10px;">
    Search Parking @location/Pincode
  </div>
<div style="width: fit-content; text-align: left; width: fit-content; text-align: left;">
  
  <input type="text"
         id="prime_location"
         name="prime_location"
         placeholder="Enter location or pincode"
         style="padding: 8px 12px; font-size: 16px; border-radius: 5px; border: 1px solid #ccc; width: 250px;">
             <button type="submit" class="btn btn-primary">Search</button>

</div>

    </form>

</div>
{% if parking_lots %}
{% if flag %}
<div class="header">All Available Parking Lots</div>
{%else%}
<div class="header">Parking Lots @{{parking_lots[0][1]}}</div>
{%endif%}
{% else %}
<div class="header">No Parking Lots Found</div>
{% endif %}

<div class="table-container">
    <table class="styled-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Prime Location Name</th>
                <th>Address</th>
                <th>Number of Availabile Spots</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% if parking_lots %}
            {%for lot in parking_lots%}
            <tr>
                <td>{{lot[0]}}</td>
                <td>{{lot['prime_location']}}</td>
                <td>{{lot[3]}}</td>
                <td>{{lot['no_of_available']}}</td>
                <td><label for="book-modal-toggle-{{lot[0]}}" class="btn btn-primary-book">Book</label>
                        <link rel="stylesheet" href="/static/popup.css">


    <input type="checkbox" id="book-modal-toggle-{{lot[0]}}" class="modal-toggle" hidden>

    <div class="modal">
        <div class="modal-content">
            <label for="book-modal-toggle-{{lot[0]}}" class="close-btn">X</label>
            <h5>Book a Parking Spot</h5>
            <form method="POST">
                <input type="hidden" name="form_type" value="book_lot">

                <input type="text" name="spot_number" value="{%for data in available_slot_data%}{%if data[0]==lot['id']%}{{data[1]}}{%endif%}{%endfor%}" placeholder="Spot Number" readonly><br>
                <input type="text" name="lot_id" value="{{lot['id']}}" readonly hidden  >
                <input type="text" name="prime_location" value="{{lot['prime_location']}}" readonly  ><br>
                <input type="text" name="user_email" value="{{session['email']}}" readonly ><br>
                <input type="text" name="vehicle_number"  required><br>
                <button type="submit">Book</button>
                        <label for="book-modal-toggle-{{lot[0]}}" class="btn btn-secondary cancel-btn">Cancel</label>
            </form>
        </div>
    </div></td>
                
            </tr>
            {%endfor%}
            {% else %}
    <tr><td colspan="5">No parking lots found.</td></tr>
{% endif %}
        </tbody>
    </table>
</div>

{%endblock%}